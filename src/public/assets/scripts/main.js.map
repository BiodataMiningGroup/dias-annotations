{"version":3,"sources":["annotations/main.js","annotations/controllers/AnnotatorController.js","annotations/controllers/CanvasController.js","annotations/controllers/SVGController.js","annotations/services/images.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"main.js","sourcesContent":["/**\n * @namespace dias.annotations\n * @description The DIAS annotations module.\n */\nangular.module('dias.annotations', ['dias.api']);\n","/**\n * @namespace dias.annotations\n * @ngdoc controller\n * @name AnnotatorController\n * @memberOf dias.annotations\n * @description Main controller of the Annotator application.\n */\nangular.module('dias.annotations').controller('AnnotatorController', function ($scope, $element, $attrs, images) {\n\t\t\"use strict\";\n\n\t\t$scope.images = images;\n\t\timages.init($attrs.transectId);\n\t\timages.show(parseInt($attrs.imageId));\n\t}\n);","/**\n * @namespace dias.annotations\n * @ngdoc controller\n * @name CanvasController\n * @memberOf dias.annotations\n * @description Main controller for the annotation canvas element\n */\nangular.module('dias.annotations').controller('CanvasController', function ($scope, $element) {\n\t\t\"use strict\";\n\n\t\tvar offsetTop = 0;\n\n\t\t// the current mouse position relative to the canvas container\n\t\t$scope.mouseX = 0;\n\t\t$scope.mouseY = 0;\n\n\t\t// the dimensions of the canvas container\n\t\tvar updateDimensions = function () {\n\t\t\t$scope.width = $element[0].offsetWidth;\n\t\t\t$scope.height = $element[0].offsetHeight;\n\t\t};\n\n\t\tupdateDimensions();\n\n\t\twindow.addEventListener('resize', function () {\n\t\t\t$scope.$apply(updateDimensions);\n\t\t});\n\n\t\t$scope.updateMouse = function (e) {\n\t\t\t$scope.mouseX = e.clientX;\n\t\t\t$scope.mouseY = e.clientY - offsetTop;\n\t\t};\n\n\t\tvar updateOffset = function () {\n\t\t\toffsetTop = $element[0].offsetTop;\n\t\t};\n\n\t\tupdateOffset();\n\n\t\twindow.addEventListener('resize', updateOffset);\n\t}\n);","/**\n * @namespace dias.annotations\n * @ngdoc controller\n * @name SVGController\n * @memberOf dias.annotations\n * @description Controller for the annotation canvas SVG element\n */\nangular.module('dias.annotations').controller('SVGController', function ($scope, $element) {\n\t\t\"use strict\";\n\n\t\tvar scaleStep = 0.05;\n\t\tvar scaleTmp;\n\n\t\t$scope.scale = 1;\n\t\t// translate the elements so they appear to be zooming towards the cursor\n\t\t$scope.scaleTranslateX = 0;\n\t\t$scope.scaleTranslateY = 0;\n\t\t$scope.translateX = 0;\n\t\t$scope.translateY = 0;\n\t\t// mouse position taking zooming and translating into account\n\t\t$scope.relativeMouseX = $scope.mouseX;\n\t\t$scope.relativeMouseY = $scope.mouseY;\n\n\t\t// scale around the cursor\n\t\t// see http://stackoverflow.com/a/20996105/1796523\n\t\tvar updateScaleTranslate = function (scale, oldScale) {\n\t\t\tvar scaleDifference = scale / oldScale;\n\n\t\t\t$scope.scaleTranslateX = scaleDifference * ($scope.scaleTranslateX - $scope.mouseX) + $scope.mouseX;\n\t\t\t$scope.scaleTranslateY = scaleDifference * ($scope.scaleTranslateY - $scope.mouseY) + $scope.mouseY;\n\t\t};\n\n\t\tvar updateRelativeMouseX = function (mouseX) {\n\t\t\t$scope.relativeMouseX = (mouseX - $scope.scaleTranslateX) / $scope.scale - $scope.translateX;\n\t\t};\n\n\t\tvar updateRelativeMouseY = function (mouseY) {\n\t\t\t$scope.relativeMouseY = (mouseY - $scope.scaleTranslateY) / $scope.scale - $scope.translateY;\n\t\t};\n\n\t\tvar transform = function (e) {\n\t\t\tif (e.ctrlKey) {\n\t\t\t\t$scope.scale -= scaleStep * e.deltaY;\n\t\t\t\te.preventDefault();\n\t\t\t} else {\n\t\t\t\t$scope.translateX -= e.deltaX / $scope.scale;\n\t\t\t\t$scope.translateY -= e.deltaY / $scope.scale;\n\t\t\t\t$scope.scale -= scaleStep * e.deltaZ;\n\t\t\t}\n\t\t};\n\n\t\t$element.on('wheel', function (e) {\n\t\t\t$scope.$apply(function () { transform(e); });\n\t\t});\n\n\t\t$scope.$watch('scale', updateScaleTranslate);\n\n\t\t$scope.$watch('mouseX', updateRelativeMouseX);\n\t\t$scope.$watch('mouseY', updateRelativeMouseY);\n\t}\n);","/**\n * @namespace dias.annotations\n * @ngdoc service\n * @name images\n * @memberOf dias.annotations\n * @description Manages (pre-)loading of the images to annotate.\n */\nangular.module('dias.annotations').service('images', function ($rootScope, TransectImage, URL) {\n\t\t\"use strict\";\n\n\t\t// svg namespace\n\t\tvar SVGNS = \"http://www.w3.org/2000/svg\";\n\t\tvar _this = this;\n\t\tvar imageIds = [];\n\t\tvar currentId;\n\n\t\tthis.buffer = [];\n\t\tthis.loading = true;\n\n\t\tvar show = function (id) {\n\t\t\tfor (var i = _this.buffer.length - 1; i >= 0; i--) {\n\t\t\t\t_this.buffer[i]._show = _this.buffer[i]._id == id;\n\t\t\t}\n\t\t\t_this.loading = false;\n\t\t\tcurrentId = id;\n\t\t};\n\n\t\tvar hasIdInBuffer = function (id) {\n\t\t\tfor (var i = _this.buffer.length - 1; i >= 0; i--) {\n\t\t\t\tif (_this.buffer[i]._id == id) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\n\t\tvar fetchImage = function (id) {\n\t\t\tif (hasIdInBuffer(id)) {\n\t\t\t\tshow(id);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t_this.loading = true;\n\t\t\tvar img = document.createElement('img');\n\t\t\timg._id = id;\n\t\t\timg.onload = function () {\n\t\t\t\t_this.buffer.push(img);\n\t\t\t\tshow(id);\n\t\t\t\t$rootScope.$apply();\n\t\t\t};\n\t\t\timg.src = URL + \"/api/v1/images/\" + id + \"/file\";\n\t\t\t// var img = document.createElementNS(SVGNS, \"image\");\n\t\t\t// img.href.baseVal = URL + \"/api/v1/images/\" + 1 + \"/file\";\n\t\t\t// img.width.baseVal.value = 100;\n\t\t\t// img.height.baseVal.value = 100;\n\t\t\t// console.log(img, img2);\n\t\t};\n\n\t\t// initializes the service for a given transect and a given \"start\" image\n\t\tthis.init = function (transectId) {\n\t\t\timageIds = TransectImage.query({transect_id: transectId});\n\t\t\t\n\t\t};\n\n\t\tthis.show = function (id) {\n\t\t\tfetchImage(id);\n\t\t};\n\n\t\tthis.next = function () {\n\t\t\tvar index = imageIds.indexOf(currentId);\n\t\t\tfetchImage(imageIds[(index + 1) % imageIds.length]);\n\t\t};\n\n\t\tthis.prev = function () {\n\t\t\tvar index = imageIds.indexOf(currentId);\n\t\t\tvar length = imageIds.length;\n\t\t\tfetchImage(imageIds[(index - 1 + length) % length]);\n\t\t};\n\t}\n);"],"sourceRoot":"/source/"}